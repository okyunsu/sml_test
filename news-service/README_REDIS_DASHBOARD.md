# News Service - Redis ê¸°ë°˜ ìë™ ëŒ€ì‹œë³´ë“œ

ê¸°ì¡´ News Serviceì— **Redis + Celery Worker**ë¥¼ ì¶”ê°€í•˜ì—¬ **30ë¶„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì‚¼ì„±ì „ì, LGì „ì ë‰´ìŠ¤ë¥¼ ë¶„ì„**í•˜ê³  ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. ìë™ ë‰´ìŠ¤ ë¶„ì„
- **30ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰**: ì‚¼ì„±ì „ì, LGì „ì ë‰´ìŠ¤ ë¶„ì„
- **ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬**: ë©”ì¸ API ì„±ëŠ¥ì— ì˜í–¥ ì—†ìŒ
- **Redis ìºì‹±**: ë¶„ì„ ê²°ê³¼ë¥¼ 24ì‹œê°„ ìºì‹œ
- **ë¶„ì„ íˆìŠ¤í† ë¦¬**: ê³¼ê±° ë¶„ì„ ì´ë ¥ ìµœëŒ€ 50ê°œ ë³´ê´€

### 2. ëŒ€ì‹œë³´ë“œ API
- **ì‹¤ì‹œê°„ ìƒíƒœ ì¡°íšŒ**: í˜„ì¬ ë¶„ì„ ìƒíƒœ ë° Redis ì—°ê²° ìƒíƒœ
- **íšŒì‚¬ë³„ ë¶„ì„ ê²°ê³¼**: ìµœì‹  ë¶„ì„ ê²°ê³¼ ë° íˆìŠ¤í† ë¦¬ ì¡°íšŒ
- **ìˆ˜ë™ ë¶„ì„ ìš”ì²­**: ì¦‰ì‹œ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš° ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
- **ìºì‹œ ê´€ë¦¬**: ìºì‹œ ì •ë³´ ì¡°íšŒ ë° ì‚­ì œ

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   News API      â”‚    â”‚  Celery Worker  â”‚    â”‚  Celery Beat    â”‚
â”‚  (FastAPI)      â”‚    â”‚ (ë‰´ìŠ¤ ë¶„ì„)     â”‚    â”‚ (30ë¶„ ìŠ¤ì¼€ì¤„)   â”‚
â”‚  Port: 8002     â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Redis       â”‚
                    â”‚  (ë©”ì‹œì§€í+ìºì‹œ) â”‚
                    â”‚   Port: 6379    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ ìƒˆë¡œìš´ API ì—”ë“œí¬ì¸íŠ¸

### ëŒ€ì‹œë³´ë“œ ìƒíƒœ ê´€ë¦¬

#### 1. ì „ì²´ ìƒíƒœ ì¡°íšŒ
```http
GET /api/v1/dashboard/status
```
**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "status": "running",
  "redis_connected": true,
  "monitored_companies": ["ì‚¼ì„±ì „ì", "LGì „ì"],
  "last_analysis_at": "2024-01-15T10:30:00",
  "total_success": 2,
  "total_error": 0
}
```

#### 2. ëª¨ë‹ˆí„°ë§ íšŒì‚¬ ëª©ë¡
```http
GET /api/v1/dashboard/companies
```

### ë¶„ì„ ê²°ê³¼ ì¡°íšŒ

#### 3. íŠ¹ì • íšŒì‚¬ ìµœì‹  ë¶„ì„ ê²°ê³¼
```http
GET /api/v1/dashboard/analysis/ì‚¼ì„±ì „ì
```

#### 4. íŠ¹ì • íšŒì‚¬ ë¶„ì„ íˆìŠ¤í† ë¦¬
```http
GET /api/v1/dashboard/analysis/ì‚¼ì„±ì „ì/history?limit=10
```

#### 5. ëª¨ë“  íšŒì‚¬ ìµœì‹  ë¶„ì„ ê²°ê³¼
```http
GET /api/v1/dashboard/latest
```

### ìˆ˜ë™ ì œì–´

#### 6. íŠ¹ì • íšŒì‚¬ ìˆ˜ë™ ë¶„ì„ ìš”ì²­
```http
POST /api/v1/dashboard/analyze/ì‚¼ì„±ì „ì
```

#### 7. ìºì‹œ ì •ë³´ ì¡°íšŒ
```http
GET /api/v1/dashboard/cache/info
```

#### 8. íŠ¹ì • íšŒì‚¬ ìºì‹œ ì‚­ì œ
```http
DELETE /api/v1/dashboard/cache/ì‚¼ì„±ì „ì
```

## ğŸ³ ì‹¤í–‰ ë°©ë²•

### 1. Redis í¬í•¨ ì „ì²´ ì„œë¹„ìŠ¤ ì‹¤í–‰
```bash
# Redis + News Service + Celery Worker + Beat ëª¨ë‘ ì‹¤í–‰
docker-compose -f docker-compose.redis.yml up -d

# ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.redis.yml logs -f
```

### 2. ê°œë³„ ì„œë¹„ìŠ¤ ì‹¤í–‰ (ê°œë°œ í™˜ê²½)
```bash
# 1ë‹¨ê³„: Redis ì‹¤í–‰
docker run -d --name redis -p 6379:6379 redis:7-alpine

# 2ë‹¨ê³„: News Service ì‹¤í–‰
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8002

# 3ë‹¨ê³„: Celery Worker ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
celery -A app.workers.celery_app worker --loglevel=info

# 4ë‹¨ê³„: Celery Beat ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
celery -A app.workers.celery_app beat --loglevel=info
```

## ğŸ“Š ëŒ€ì‹œë³´ë“œ í™•ì¸ ë°©ë²•

### 1. Swagger UIì—ì„œ í…ŒìŠ¤íŠ¸
```
http://localhost:8002/docs
```
- `/api/v1/dashboard/*` ì—”ë“œí¬ì¸íŠ¸ë“¤ì„ ì§ì ‘ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

### 2. ë¶„ì„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
```bash
# ì „ì²´ ìƒíƒœ í™•ì¸
curl http://localhost:8002/api/v1/dashboard/status

# ì‚¼ì„±ì „ì ìµœì‹  ë¶„ì„ ê²°ê³¼ í™•ì¸
curl http://localhost:8002/api/v1/dashboard/analysis/ì‚¼ì„±ì „ì

# ëª¨ë“  íšŒì‚¬ ìµœì‹  ê²°ê³¼ í™•ì¸
curl http://localhost:8002/api/v1/dashboard/latest
```

### 3. ìˆ˜ë™ ë¶„ì„ ì‹¤í–‰
```bash
# ì‚¼ì„±ì „ì ì¦‰ì‹œ ë¶„ì„ (ë°±ê·¸ë¼ìš´ë“œ)
curl -X POST http://localhost:8002/api/v1/dashboard/analyze/ì‚¼ì„±ì „ì
```

## âš™ï¸ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜
```bash
# .env íŒŒì¼ ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
REDIS_URL=redis://localhost:6379/0
MODEL_NAME=test123
```

### ë¶„ì„ ì£¼ê¸° ë³€ê²½
`app/workers/celery_app.py`ì—ì„œ ìŠ¤ì¼€ì¤„ ë³€ê²½ ê°€ëŠ¥:
```python
# 30ë¶„ë§ˆë‹¤ â†’ 15ë¶„ë§ˆë‹¤ ë³€ê²½
"schedule": crontab(minute="*/15"),

# ë§¤ ì‹œê°„ ì •ê° â†’ 30ë¶„ë§ˆë‹¤ ë³€ê²½  
"schedule": crontab(minute="*/30"),
```

### ë¶„ì„ ëŒ€ìƒ íšŒì‚¬ ë³€ê²½
`app/api/dashboard_router.py`ì—ì„œ íšŒì‚¬ ëª©ë¡ ë³€ê²½:
```python
MONITORED_COMPANIES = ["ì‚¼ì„±ì „ì", "LGì „ì", "SKí•˜ì´ë‹‰ìŠ¤"]
```

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. Redis ì—°ê²° ì˜¤ë¥˜
```bash
# Redis ìƒíƒœ í™•ì¸
docker ps | grep redis
redis-cli ping
```

### 2. Celery ì‘ì—… í™•ì¸
```bash
# í™œì„± ì‘ì—… í™•ì¸
celery -A app.workers.celery_app inspect active

# ë“±ë¡ëœ ì‘ì—… í™•ì¸
celery -A app.workers.celery_app inspect registered
```

### 3. ë¶„ì„ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
- ì²« ì‹¤í–‰ í›„ 30ë¶„ ëŒ€ê¸° (ìë™ ë¶„ì„)
- ë˜ëŠ” ìˆ˜ë™ ë¶„ì„ ì‹¤í–‰: `POST /api/v1/dashboard/analyze/{company}`

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: Worker 1.5GB, Beat 256MBë¡œ ì œí•œ
- **CPU ì‚¬ìš©ëŸ‰**: Worker 1ì½”ì–´, Beat 0.5ì½”ì–´ë¡œ ì œí•œ
- **ìºì‹œ ë§Œë£Œ**: ë¶„ì„ ê²°ê³¼ 24ì‹œê°„, íˆìŠ¤í† ë¦¬ 7ì¼
- **ë™ì‹œì„±**: Worker 2ê°œ í”„ë¡œì„¸ìŠ¤ë¡œ ë™ì‹œ ì²˜ë¦¬

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ APIë“¤ì„ í™œìš©í•˜ì—¬:
1. **ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ** êµ¬í˜„
2. **ì°¨íŠ¸/ê·¸ë˜í”„** ì‹œê°í™”
3. **WebSocket ì—°ê²°** (ì¶”ê°€ ê°œë°œ í•„ìš”)
4. **ì•Œë¦¼ ê¸°ëŠ¥** (ì´ë©”ì¼/ìŠ¬ë™ ë“±) 