# News Service ë„ì»¤ ì‹¤í–‰ ëª…ë ¹ì–´ ê°€ì´ë“œ (ë¦¬íŒ©í† ë§ ì™„ë£Œ v2.0)
# ============================================================================

## ğŸš€ ì‹¤í–‰ ì „ ì¤€ë¹„ì‚¬í•­

# 1. news-service ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd news-service

# 2. .env íŒŒì¼ ìƒì„± (í•„ìˆ˜)
cat > .env << EOF
# Naver API ì„¤ì • (í•„ìˆ˜)
NAVER_CLIENT_ID=your_actual_client_id
NAVER_CLIENT_SECRET=your_actual_client_secret

# ëª¨ë¸ ì„¤ì •
MODEL_NAME=test123

# ML ì„¤ì •
MODELS_DIR=/app/models
MONITORED_COMPANIES=ì‚¼ì„±ì „ì,LGì „ì

# ì„œë¹„ìŠ¤ ì„¤ì •
LOG_LEVEL=INFO
EOF

# 3. .env íŒŒì¼ ê¶Œí•œ ì„¤ì • (ë³´ì•ˆ)
chmod 600 .env

## ğŸ“¦ ì‹¤í–‰ ë°©ë²• 1: ë¹ ë¥¸ ì‹œì‘ (CPU ë‹¨ì¼ ì„œë¹„ìŠ¤)
# ============================================================================

# ì‹¤í–‰
docker-compose -f docker-compose.cpu.yml up -d

# ìƒíƒœ í™•ì¸
docker ps
docker logs news-service-cpu --tail 20

# ì¤‘ì§€
docker-compose -f docker-compose.cpu.yml down

## ğŸ“¦ ì‹¤í–‰ ë°©ë²• 2: ì™„ì „í•œ ìŠ¤íƒ (CPU + Redis + Celery + ëŒ€ì‹œë³´ë“œ)
# ============================================================================
# ì£¼ì˜: ì´ê²ƒë„ CPU í™˜ê²½ì…ë‹ˆë‹¤! GPU ì•„ë‹˜!

# ì‹¤í–‰ (Redis + API + Celery Worker + Celery Beat - ëª¨ë‘ CPU ê¸°ë°˜)
docker-compose -f docker-compose.redis.yml up -d

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose -f docker-compose.redis.yml ps

# ì „ì²´ ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.redis.yml logs -f --tail 10

# ê°œë³„ ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.redis.yml logs -f news-service
docker-compose -f docker-compose.redis.yml logs -f celery-worker
docker-compose -f docker-compose.redis.yml logs -f celery-beat
docker-compose -f docker-compose.redis.yml logs -f redis

# ì¤‘ì§€
docker-compose -f docker-compose.redis.yml down

## ğŸ“¦ ì‹¤í–‰ ë°©ë²• 3: GPU í™˜ê²½ (ê³ ì„±ëŠ¥, ë†’ì€ ì»´í“¨íŒ… íŒŒì›Œ í•„ìš”)
# ============================================================================
# ì£¼ì˜: GPU ë©”ëª¨ë¦¬ 8GB+ ê¶Œì¥, ë†’ì€ ì»´í“¨íŒ… íŒŒì›Œ í•„ìš”!

# ì‚¬ì „ ìš”êµ¬ì‚¬í•­ í™•ì¸ (NVIDIA Container Toolkit)
docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi

# ì‹¤í–‰ (ë‹¨ì¼ ì„œë¹„ìŠ¤, GPU ê°€ì†)
docker-compose -f docker-compose.gpu.yml up -d

# GPU ì‚¬ìš© í™•ì¸
docker exec news-service-gpu nvidia-smi

# ì¤‘ì§€
docker-compose -f docker-compose.gpu.yml down

## ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
# ============================================================================

### ê¸°ë³¸ í—¬ìŠ¤ì²´í¬
curl http://localhost:8002/health
curl http://localhost:8002/docs

### ğŸ” ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ API í…ŒìŠ¤íŠ¸ (ìºì‹œ ìš°ì„ )
# íšŒì‚¬ ë‰´ìŠ¤ ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰
curl -X POST http://localhost:8002/api/v1/search/companies/ì‚¼ì„±ì „ì \
  -H "Content-Type: application/json"

# íšŒì‚¬ ë‰´ìŠ¤ ìŠ¤ë§ˆíŠ¸ ë¶„ì„
curl -X POST http://localhost:8002/api/v1/search/companies/LGì „ì/analyze \
  -H "Content-Type: application/json"

# ì¼ë°˜ ë‰´ìŠ¤ ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰
curl -X POST http://localhost:8002/api/v1/search/news \
  -H "Content-Type: application/json" \
  -d '{"query": "ESG", "display": 5}'

# íŠ¸ë Œë”© í‚¤ì›Œë“œ
curl http://localhost:8002/api/v1/search/trending

### ğŸ“Š ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ (Redis ìŠ¤íƒì—ì„œë§Œ - CPU í™˜ê²½)
# ì£¼ì˜: docker-compose.redis.ymlë¡œ ì‹¤í–‰í–ˆì„ ë•Œë§Œ ê°€ëŠ¥!
# ëŒ€ì‹œë³´ë“œ ì „ì²´ ìƒíƒœ
curl http://localhost:8002/api/v1/dashboard/status

# ëª¨ë‹ˆí„°ë§ íšŒì‚¬ ëª©ë¡
curl http://localhost:8002/api/v1/dashboard/companies

# íŠ¹ì • íšŒì‚¬ ìµœì‹  ë¶„ì„ ê²°ê³¼
curl http://localhost:8002/api/v1/dashboard/companies/ì‚¼ì„±ì „ì/latest

# íŠ¹ì • íšŒì‚¬ ë¶„ì„ íˆìŠ¤í† ë¦¬
curl http://localhost:8002/api/v1/dashboard/companies/ì‚¼ì„±ì „ì/history

# ëª¨ë“  íšŒì‚¬ ìµœì‹  ë¶„ì„ ê²°ê³¼
curl http://localhost:8002/api/v1/dashboard/latest

# ë°±ê·¸ë¼ìš´ë“œ ë¶„ì„ ìš”ì²­
curl -X POST http://localhost:8002/api/v1/dashboard/companies/ì‚¼ì„±ì „ì/trigger

# ìºì‹œ ì •ë³´ í™•ì¸
curl http://localhost:8002/api/v1/dashboard/cache/info

# íšŒì‚¬ ìºì‹œ ì‚­ì œ
curl -X DELETE http://localhost:8002/api/v1/dashboard/cache/ì‚¼ì„±ì „ì

### ğŸ› ï¸ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (Redis ìŠ¤íƒì—ì„œë§Œ - CPU í™˜ê²½)
# ì£¼ì˜: docker-compose.redis.ymlë¡œ ì‹¤í–‰í–ˆì„ ë•Œë§Œ ê°€ëŠ¥!
# ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬
curl http://localhost:8002/api/v1/system/health

# Celery Worker í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8002/api/v1/system/test/celery

# 5ì´ˆ í›„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸
sleep 5
curl http://localhost:8002/api/v1/system/test/result

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ëª…ë ¹ì–´
# ============================================================================

### ì»¨í…Œì´ë„ˆ ìƒíƒœ ë° ë¡œê·¸ í™•ì¸
# ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps -a

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
docker stats

# íŠ¹ì • ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
docker logs news-service-cpu --tail 50 -f
docker logs news-service-api --tail 50 -f
docker logs news-celery-worker --tail 50 -f

### í™˜ê²½ë³€ìˆ˜ í™•ì¸
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™˜ê²½ë³€ìˆ˜ í™•ì¸
docker exec news-service-cpu env | grep -E "NAVER|MODEL|REDIS"

# .env íŒŒì¼ ë‚´ìš© í™•ì¸
cat .env

### ëª¨ë¸ ë””ë ‰í† ë¦¬ í™•ì¸
# ëª¨ë¸ íŒŒì¼ ì¡´ì¬ í™•ì¸
ls -la ../newstun-service/models/
docker exec news-service-cpu ls -la /app/models/

# ëª¨ë¸ ë¡œë”© ìƒíƒœ í™•ì¸ (ë¡œê·¸ì—ì„œ)
docker logs news-service-cpu 2>&1 | grep -i "ëª¨ë¸\|model"

### Redis ì—°ê²° í™•ì¸ (Redis ìŠ¤íƒ)
# Redis ì»¨í…Œì´ë„ˆ ìƒíƒœ
docker exec news-redis redis-cli ping

# Redis ë°ì´í„° í™•ì¸
docker exec news-redis redis-cli keys "*"

# Redis ì—°ê²° í…ŒìŠ¤íŠ¸
curl http://localhost:8002/api/v1/dashboard/cache/info

### ë„¤íŠ¸ì›Œí¬ ë° í¬íŠ¸ í™•ì¸
# í¬íŠ¸ ë°”ì¸ë”© í™•ì¸
docker port news-service-cpu
netstat -tulpn | grep :8002

# ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker network ls
docker inspect news-service-network

### ë©”ëª¨ë¦¬ ë° ì„±ëŠ¥ ë¬¸ì œ
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìƒì„¸ í™•ì¸
docker exec news-service-cpu free -h
docker exec news-service-cpu ps aux --sort=-%mem | head -10

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸
docker system df
docker exec news-service-cpu df -h

## ğŸ”„ ì¬ì‹œì‘ ë° ì´ˆê¸°í™” ëª…ë ¹ì–´
# ============================================================================

### ì„œë¹„ìŠ¤ ì¬ì‹œì‘
# CPU ë‹¨ì¼ ì„œë¹„ìŠ¤
docker-compose -f docker-compose.cpu.yml restart

# Redis ì „ì²´ ìŠ¤íƒ
docker-compose -f docker-compose.redis.yml restart

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ì‹œì‘
docker-compose -f docker-compose.redis.yml restart news-service
docker-compose -f docker-compose.redis.yml restart celery-worker

### ì™„ì „ ì´ˆê¸°í™”
# ëª¨ë“  ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì‚­ì œ
docker-compose -f docker-compose.cpu.yml down --remove-orphans
docker-compose -f docker-compose.redis.yml down --remove-orphans --volumes

# ì´ë¯¸ì§€ ì¬ë¹Œë“œ
docker-compose -f docker-compose.cpu.yml build --no-cache
docker-compose -f docker-compose.redis.yml build --no-cache

# ì‹œìŠ¤í…œ ì •ë¦¬
docker system prune -f
docker volume prune -f

## ğŸ“Š ì„±ëŠ¥ ì¸¡ì • ëª…ë ¹ì–´
# ============================================================================

### API ì‘ë‹µ ì‹œê°„ ì¸¡ì •
# ë‰´ìŠ¤ ê²€ìƒ‰ ì„±ëŠ¥
time curl -X POST http://localhost:8002/api/v1/news/company/simple \
  -H "Content-Type: application/json" \
  -d '{"company": "ì‚¼ì„±ì „ì"}' \
  -w "Response time: %{time_total}s\n"

# ëŒ€ì‹œë³´ë“œ ì‘ë‹µ ì„±ëŠ¥
time curl http://localhost:8002/api/v1/dashboard/status \
  -w "Response time: %{time_total}s\n"

### ë™ì‹œ ìš”ì²­ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (Apache Bench ì‚¬ìš© ì‹œ)
# ë™ì‹œ 10ê°œ ìš”ì²­, ì´ 100ê°œ ìš”ì²­
ab -n 100 -c 10 -H "Content-Type: application/json" \
  -p test_data.json http://localhost:8002/api/v1/news/company/simple

# test_data.json íŒŒì¼ ìƒì„±
echo '{"company": "ì‚¼ì„±ì „ì"}' > test_data.json

## ğŸ“ ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸ URL (í†µí•© ë¼ìš°í„° v2.0)
# ============================================================================
# API ë¬¸ì„œ (Swagger): http://localhost:8002/docs
# ë£¨íŠ¸ í˜ì´ì§€: http://localhost:8002/
# í—¬ìŠ¤ì²´í¬: http://localhost:8002/health ë˜ëŠ” http://localhost:8002/api/v1/system/health

# ğŸ” ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ (ìºì‹œ ìš°ì„ )
# íšŒì‚¬ ë‰´ìŠ¤ ê²€ìƒ‰: http://localhost:8002/api/v1/search/companies/{company}
# íšŒì‚¬ ë‰´ìŠ¤ ë¶„ì„: http://localhost:8002/api/v1/search/companies/{company}/analyze
# ì¼ë°˜ ë‰´ìŠ¤ ê²€ìƒ‰: http://localhost:8002/api/v1/search/news

# ğŸ“Š ëŒ€ì‹œë³´ë“œ (ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„°)
# ëŒ€ì‹œë³´ë“œ ìƒíƒœ: http://localhost:8002/api/v1/dashboard/status
# íšŒì‚¬ ìµœì‹  ë¶„ì„: http://localhost:8002/api/v1/dashboard/companies/{company}/latest
# ëª¨ë“  íšŒì‚¬ ê²°ê³¼: http://localhost:8002/api/v1/dashboard/latest

# ğŸ› ï¸ ì‹œìŠ¤í…œ ê´€ë¦¬
# ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬: http://localhost:8002/api/v1/system/health
# Celery í…ŒìŠ¤íŠ¸: http://localhost:8002/api/v1/system/test/celery

## ğŸ¯ ê¶Œì¥ ì‹¤í–‰ ìˆœì„œ (ëª¨ë‘ ë…ë¦½ì )
# ============================================================================
# 1. ê°œë°œ/í…ŒìŠ¤íŠ¸: docker-compose.cpu.yml (CPU, ê°€ë²¼ì›€, ë‹¨ì¼ ì„œë¹„ìŠ¤)
# 2. ì™„ì „í•œ ê¸°ëŠ¥: docker-compose.redis.yml (CPU + Redis + Celery, ì „ì²´ ìŠ¤íƒ)
# 3. ê³ ì„±ëŠ¥ í•„ìš”: docker-compose.gpu.yml (GPU, ë‹¨ì¼ ì„œë¹„ìŠ¤, ë†’ì€ ë¦¬ì†ŒìŠ¤ í•„ìš”)

# ğŸ”¥ ì¼ë°˜ì ìœ¼ë¡œëŠ” ë°©ë²• 2 (Redis ìŠ¤íƒ)ì„ ì¶”ì²œí•©ë‹ˆë‹¤!
# GPUëŠ” ì»´í“¨íŒ… íŒŒì›Œê°€ ì¶©ë¶„í•  ë•Œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.

## ğŸ’¡ ìœ ìš©í•œ íŒ
# ============================================================================
# - ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸: docker-compose logs -f
# - íŠ¹ì • ì„œë¹„ìŠ¤ ì¬ì‹œì‘: docker-compose restart [service_name]
# - í™˜ê²½ë³€ìˆ˜ ë³€ê²½ í›„: docker-compose down && docker-compose up -d
# - ì„±ëŠ¥ ì´ìŠˆ ì‹œ: docker statsë¡œ ë¦¬ì†ŒìŠ¤ í™•ì¸
# - Redis ë°ì´í„° ì´ˆê¸°í™”: docker-compose down --volumes

# ì‘ì„±ì¼: 2024ë…„ (í†µí•© ë¼ìš°í„° v2.0 - ìŠ¤ë§ˆíŠ¸ ìºì‹œ)
# ì•„í‚¤í…ì²˜: Clean Architecture + ì˜ì¡´ì„± ì£¼ì… + í†µí•© ë¼ìš°í„° + ìŠ¤ë§ˆíŠ¸ ìºì‹œ
# 
# ğŸ“‹ ì£¼ìš” ê°œì„ ì‚¬í•­:
# â€¢ ë¼ìš°í„° í†µí•©: news_router + dashboard_router â†’ unified_router
# â€¢ ìŠ¤ë§ˆíŠ¸ ìºì‹œ: ìºì‹œ ìš°ì„  â†’ ì‹¤ì‹œê°„ í´ë°± ì „ëµ
# â€¢ ì‚¬ìš© ëª©ì ë³„ ë¶„ë¦¬: /search (ì‹¤ì‹œê°„) vs /dashboard (ë°±ê·¸ë¼ìš´ë“œ)
# â€¢ í–¥ìƒëœ ì„±ëŠ¥: ìºì‹œ íˆíŠ¸ ì‹œ 100ms, ìºì‹œ ë¯¸ìŠ¤ ì‹œì—ë§Œ ì‹¤ì‹œê°„ ì²˜ë¦¬ 